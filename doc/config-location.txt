the directory 'generic/' contains the default configuration settings.

is copied in /usr/local/var/sniffjoke/ 

this directory contains the "location directory"

the concept of location stands for a network place where you use sniffjoke;
sniffjoke can configure and optimize itself for every location separately and 
and the generic will work instead for the most of the time.

* WHAT IS sniffjoke-autotest ? 

Is a script performing some sniffjoke tests and verifications to detect which kind of attack
can be used for be used in your network.

The problem solved by the autotest suite arise because not every kind of evasion technology
can work in every network.
The script takes as argumet the location name, creates the new directory /usr/local/var/sniffjoke/$NEWLOCATION
and prepare all the related configuration files inside.

When you need to use a specific locaton, you have to run sniffjoke with --location $LOCATIONNAME and
the related directory will be used for the chrook; from that time on sniffjoke will use that directory as storage dir for
logs and caches.

* WHAT THE MEANING OF EVERY SINGLE CONFIG FILE ?

***	plugins-enabled.conf

It contains the list of the plugins to be used in your sniffjoke service. The plugins
are the shared object contained in src/plugins and installed in 
/usr/local/lib/sniffjoke/*.so

The configuration file contains these information:

# comment
plugin_name,SCRAMBLETECHSUPPORTED1,SCRAMBLETECHSUPPORTED2,...

the plugin_name is exposed without path and intended to be found in the 
/usr/local/lib/sniffjoke directory. the scramble technology are separated by
a comma and without whitespace, where the accepted scramble values are:

PRESCRIPTION
    this the scramble technology that decreases the TTL in the
    packet causing to expire before reaching the remote host

INNOCENT
    is a valid packet injected inside the stream

MALFORMED
    is a packet with rfc-valid but incoherent for the usege
    in relation with the connection state of IP and TCP options
    or other malformation based on IP/TCP options header.
GUILTY
    packet with bad checksum, discarded by the remote host
    but accepted by the sniffer (used as last resort is the less useful
    scramble but useful in the sniffjoke logic)

***	sniffjoke-service.conf

It does contain the same options that will be passed by command line:


active
    will be present or not present, and is used if sniffjoke must start 
	active in hijacking/injection or start and silently make mitm in
	the network without packet injection and session tracking
	default: not present
user
    specify the username to use for the privileges downgrade after the chroot
	default: nobody
	suggested: it's suggested to a packet mantainer to create a sniffjoke user
group
    the same as for user
	default: nogroup
	suggested: it's suggested to a packet mantainer to create a sniffjoke group
management-address
	is the ip address where sniffjoke will bind the administrative socket,
	it's a required configuration parameter if you plan to use sniffjoke in a gateway 
	and you want to manage the service by a different host
	default: 127.0.0.1
management-port
	the UDP port for the administrative traffic
	default: 8844

	note: the two management info, need to be passed in the sniffjokeclt
	(the client managing sniffjoke service) to the command line.

debug
    the verbosity level used by sniffjoke:
	1: suppress log, no one line are provided 
	2: common, startup info and error reporting
	3: verbose, description and check of I/O operation
	4: debug, intensive and complete I/O description
	5: session, creation of $LOGFILENAME.session and session debug 
	6: packets, creation of $LOGFILENAME.packet and debug of every packet
	default: 2

foreground
	it's an optional parameter used to make the sniffjoke service run in foreground
	default: no

*** ipblacklist.conf

the file containts a list of ip address, written without every other information, and
whenever the blacklist is set in sniffjoke, the connection destinated to a
matching IP address will work untouched by sniffjoke

*** ipwhitelist.conf

this is the same of blacklist, but you specify the only ip address that will 
be hacked.

*** port-aggressivity.conf

this is how the default and simplest section appears:

# this is always on the top of the port definition file, act as default
1:65535     NORMAL,COMMON

# follow the port rules
22          RARE,LIGHT
23,25,110   COMMON,NORMAL
80,8080     PEEKATSTART,EVERY5SECONDS,HEAVY
6667,7000   ALWAYS,NORMAL

# edonkey p2p
4600:4800   EVERY20SECONDS,LIGHT

you need to select the destination TCP ports, use as separator "," or ":"
with the "," you should address the single port and with the ":" a range.

Those value are tell "Frequencies" and describe the frequency of the injection.
related to the kind of session (IRC is really different, from sensibiliy of the
data, amount of bytes and number of packets, from HTTP and peer2peer), those value
should be mixed togheder, using the ","

RARE
            every packet has the 24% to be hacked
COMMON
            every packet has the 56% to be hacked
ALWAYS
            yes, every packet is hacked: 100% not good, but, useful in rare situations
PACKETS10PEEK
            when the packets count related to the session if 9, 10 or 11
            (or 19, 20, 21...) the probability is 80%, the other time, 8%
PACKETS30PEEK
            session count 29, 30, 31 (59, 60, 61), are 80%, the other, 8%
TIMEBASED5S
            when the absolute time express in seconds is divisible by 5, the probability
            is 96% the other time, 8%
TIMEBASED20S
            absolute timing in seconds divisible by 20, 96%, other time, 8%
STARTPEEK
            for the first 20 packets, 80%, since 21 to 40, 40%, after 8%
LONGPEEK
            first 60 packets 64%, since 61 to 120 32%, the other until the end 8%

the packets count is related to the original sessions packets, the hacked injected are excluded.

and those value, that REQUIRE to be ONE ALONE IN EVERY LINE, describe the Probability of
happen (because every think in sniffjoke need to be randomized, also the probability of injection).

NONE
            multiply by 0 the value returned by Frequency (suppress hacks)
LIGHT
            multiply by 4 the value returned by Frequency (you should halve the
            percentage written before)
NORMAL
            multiply by 8 (this is because every number is divisible by eight)
HEAVY
            multiply by 12

Is a matter of percentage.
if you don't know what you do, it's suggested to use the default.
if you instead find out a better default configuration please contact us commenting/sending it.
At the time olny few TCP ports are configured.

The Frequency and the Probability are the variables causing SniffJoke to be aggressive. 

How an user will manage those variables ? 

FACTS about injection:

1) A single injected packet will broke the reassembly apply by a sniffer, for this reason is not require inject a large amount of packet (will result a bandwidth loss).

2) sniffer/IDS making patter detection (string comparisation, heuristic analysis, etc...)will make this detection also without having the correctly assembled stream (fake_data.so plusing prevent from this)

3) Every sniffjoke injected packet will happen and will not, because the SniffJoke strength is based on the randomness. A non random patter will be detected and managed, a random one, will not.

SniffJoke solutions:

SniffJoke for every outgoing packet check:

    if the plugin will inject an hacked-packet: sometimes will and some other not. fake_data in example work only when the packet contains some payload.

    if the "random" choose to inject or not: the "random" is based on the configuration file port-aggressivity.conf

port-aggressivity has a strong influence about the injection happening, and the coder of the plugin too.

WHICH INPUT POINT EXISTS AND HOW THEY ARE MIXED

1) port-aggressivity.conf contains something like:

1:65535     NORMAL,COMMON
22          RARE,LIGHT
25,110,143  LONGPEEK,EVERY5SECONDS,NORMAL

2) every plugin is initialized with:

fake_syn(bool forcedTest) 
{
    Hack(HACK_NAME, forcedTest ? AGG_ALWAYS : AGG_RARE);
}

In short: every Hack specify which kind of frequency is better them use, and this probability is mixed with the probability
derived by port-aggressivity.conf

The AGG_ALWAYS is used only when the non-documentation option --only-plugin is called, an option used for testing a single
hack+scramble combination, used in sniffjoke-autotest
